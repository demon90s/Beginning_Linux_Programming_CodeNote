<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>cmake HowTo - Linux Study Note</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-XXXXXXXX-X', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Linux Study Note</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Introduction</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../ch01 入门/">ch01 入门</a>
</li>
                                    
<li >
    <a href="../../ch02 shell程序设计/">ch02 shell程序设计</a>
</li>
                                    
<li >
    <a href="../../ch03 文件操作/">ch03 文件操作</a>
</li>
                                    
<li >
    <a href="../../ch04 Linux环境/">ch04 Linux环境</a>
</li>
                                    
<li >
    <a href="../../ch05 终端/">ch05 终端</a>
</li>
                                    
<li >
    <a href="../../ch06 curses/">ch06 curses</a>
</li>
                                    
<li >
    <a href="../../ch07 数据管理/">ch07 数据管理</a>
</li>
                                    
<li >
    <a href="../../ch08 MySQL/">ch08 MySQL</a>
</li>
                                    
<li >
    <a href="../../ch09 开发工具/">ch09 开发工具</a>
</li>
                                    
<li >
    <a href="../../ch10 调试/">ch10 调试</a>
</li>
                                    
<li >
    <a href="../../ch11 进程和信号/">ch11 进程和信号</a>
</li>
                                    
<li >
    <a href="../../ch12 POSIX线程/">ch12 POSIX线程</a>
</li>
                                    
<li >
    <a href="../../ch13 进程间通信_管道/">ch13 进程间通信_管道</a>
</li>
                                    
<li >
    <a href="../../ch14 信号量_共享内存和消息队列/">ch14 信号量_共享内存和消息队列</a>
</li>
                                    
<li >
    <a href="../../ch15 套接字/">ch15 套接字</a>
</li>
                                    
<li >
    <a href="../../ch16 用GTK+进行GNOME编程/">ch16 用GTK+进行GNOME编程</a>
</li>
                                    
<li >
    <a href="../../ch17 用Qt进行KDE编程/">ch17 用Qt进行KDE编程</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">CheatSheet <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../errno/">errno</a>
</li>
                                    
<li >
    <a href="../git_github-HowTo/">Git-GitHub HowTo</a>
</li>
                                    
<li >
    <a href="../Bash-HowTo/">Bash HowTo</a>
</li>
                                    
<li >
    <a href="../CentOS7-HowTo/">CentOS7 HowTo</a>
</li>
                                    
<li >
    <a href="../Ubuntu-HowTo/">Ubuntu HowTo</a>
</li>
                                    
<li >
    <a href="../subversion-HowTo/">subversion HowTo</a>
</li>
                                    
<li >
    <a href="../GDB-HowTo/">GDB HowTo</a>
</li>
                                    
<li class="active">
    <a href="./">cmake HowTo</a>
</li>
                                    
<li >
    <a href="../ssh-HowTo/">ssh HowTo</a>
</li>
                                    
<li >
    <a href="../vim-HowTo/">vim HowTo</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../GDB-HowTo/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ssh-HowTo/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/demon90s/LinuxStudy/tree/master/notes/cheatsheet/cmake-HowTo.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#cmake-howto">cmake HowTo</a></li>
            <li><a href="#_1">概述</a></li>
            <li><a href="#_2">安装与使用</a></li>
            <li><a href="#cmakeliststxt">编写CMakeLists.txt</a></li>
            <li><a href="#_6">几个例子</a></li>
            <li><a href="#_10">参考资料</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="cmake-howto">cmake HowTo</h1>
<h2 id="_1">概述</h2>
<p>cmake可以用来生成项目工程文件，比如 Linux 下的 Makefile 等文件，VS下的 sln 等文件。cmake使用一个名为 CMakeLists.txt 的文件来描述项目构建过程。</p>
<p>使用 cmake 构建一个项目的流程如下：</p>
<ol>
<li>
<p>编写 CMakeLists.txt 文件</p>
</li>
<li>
<p>执行<code>cmake &lt;path&gt;</code>生成工程文件，path目录下存放着CMakeLists.txt文件</p>
</li>
<li>
<p>编译项目，比如 Linux 下可使用 make 命令</p>
</li>
</ol>
<h2 id="_2">安装与使用</h2>
<p>CentOS 7安装命令：</p>
<div class="codehilite"><pre><span></span>$ yum install cmake
</pre></div>


<p>Ubuntu18.04 安装命令：</p>
<div class="codehilite"><pre><span></span>$ sudo apt-get install cmake
</pre></div>


<p>Windows下直接下载安装包即可：https://cmake.org/download/</p>
<p><strong>构建项目</strong></p>
<p>下面以Linux平台为例。</p>
<p>使用方法为：</p>
<div class="codehilite"><pre><span></span>$ cmake path
$ make
</pre></div>


<p>使用path目录下的CMakeLists.txt来生成Makefile文件，生成的Makefile文件位于当前cmake命令执行目录。</p>
<p>cmake命令还会在命令执行目录生成一些中间文件。</p>
<p><strong>清理项目</strong></p>
<p>只需输入：</p>
<div class="codehilite"><pre><span></span>$ make clean
</pre></div>


<p>但不会清理cmake生成的中间文件。</p>
<p><strong>外部构建</strong></p>
<p>cmake除了会在命令执行目录生成MakeFile文件，还会生成许多一些中间文件，因此最好是把它们统一放到一个目录中，在此目录执行cmake，这就是外部构建。</p>
<p>例如，可在项目目录下创建一个build目录，作为cmake命令的执行目录，CMakeLists.txt文件放在项目目录下，然后这样构建项目：</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> build
$ cmake ..
$ make
</pre></div>


<p>这样，想要删除cmake生成的中间文件时，直接执行<code>rm -rf build</code>即可。</p>
<p>也可以这样执行外部构建：</p>
<div class="codehilite"><pre><span></span>$ cmake -H. -Bbuild
</pre></div>


<p>-H. 表示在当前目录寻找 root CMakeLists.txt 。</p>
<p>-Bbuild 表示将 cmakefiles 创建到 build 目录， build 目录也可以自动创建。</p>
<p><strong>生成Debug或Release版本的程序</strong></p>
<div class="codehilite"><pre><span></span>$ cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug path
</pre></div>


<p>这里设置了变量CMAKE_BUILD_TYPE的值为Debug，表示生成的是Debug版本的程序。还可以取值为Release。</p>
<h2 id="cmakeliststxt">编写CMakeLists.txt</h2>
<h4 id="_3">一些语法</h4>
<p>CMakeLists.txt语法由指令、变量、注释组成。</p>
<p><strong>指令</strong></p>
<p>指令由指令名、小括号、参数组成。参数以空格分隔。</p>
<p>指令可以不分大小写。</p>
<p><strong>变量</strong></p>
<p>变量分为内置的和自定义的。</p>
<p>引用变量的方法是：${变量名}。</p>
<p>变量是全局的，在上层CMakeLists.txt定义的变量，在下层可以使用。</p>
<p><strong>注释</strong></p>
<p><code>##</code>符号后面的内容被认为是注释</p>
<p><strong>条件</strong></p>
<p>使用 if else endif 来进行条件选择.</p>
<p>例子:</p>
<div class="codehilite"><pre><span></span><span class="nb">if</span> <span class="p">(</span><span class="s">CMAKE_SYSTEM_NAME</span> <span class="s">STREQUAL</span> <span class="s2">&quot;Linux&quot;</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span> <span class="s2">&quot;Configure on/for Linux&quot;</span><span class="p">)</span>
<span class="nb">elseif</span> <span class="p">(</span><span class="s">CMAKE_SYSTEM_NAME</span> <span class="s">STREQUAL</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span> <span class="s2">&quot;Configure on/for macOS&quot;</span><span class="p">)</span>
<span class="nb">elseif</span> <span class="p">(</span><span class="s">CMAKE_SYSTEM_NAME</span> <span class="s">STREQUAL</span> <span class="s2">&quot;Windows&quot;</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span> <span class="s2">&quot;Configure on/for Windows&quot;</span><span class="p">)</span>
<span class="nb">else</span> <span class="p">()</span>
    <span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span> <span class="s2">&quot;Configure on/for %{CMAKE_SYSTEM_NAME}&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>


<p>or:</p>
<div class="codehilite"><pre><span></span><span class="nb">if</span> <span class="p">(</span><span class="s">MSVC</span><span class="p">)</span>
    <span class="err">...</span>
<span class="nb">else</span> <span class="p">()</span>
    <span class="err">...</span>
<span class="nb">endif</span> <span class="p">(</span><span class="s">MSVC</span><span class="p">)</span>
</pre></div>


<h4 id="_4">一些指令</h4>
<p>在官方文档中，指令中尖括号的内容是必填项，而方括号的内容是选填项，其余的是固定内容。</p>
<p><strong>CMAKE_MINIMUM_REQUIRED</strong></p>
<p>限定cmake的版本，如果当前cmake版本低，则生成失败。通常它位于顶层CMakeLists.txt的第一行。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">CMAKE_MINIMUM_REQUIRED</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>
</pre></div>


<p><strong>PROJECT</strong></p>
<p>定义项目的名称。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">PROJECT</span><span class="p">(</span><span class="s">projectname</span><span class="p">)</span>
</pre></div>


<p>对于 vs ，这样的指令使得 sln 文件的名字为 projectname 。</p>
<p><strong>MESSAGE</strong></p>
<p>发送一段信息文本到标准输出。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">MESSAGE</span><span class="p">(</span><span class="s2">&quot;cmake start&quot;</span><span class="p">)</span>
</pre></div>


<p><strong>SET</strong></p>
<p>自定义一个变量，或者改变内置变量的值。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">VAR</span> <span class="s">[VALUE]</span><span class="p">)</span>
</pre></div>


<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">SET</span><span class="p">(</span><span class="s">SRC_LIST</span> <span class="s">main.c</span> <span class="s">t1.c</span> <span class="s">t2.c</span><span class="p">)</span>
</pre></div>


<p><strong>INCLUDE_DIRECTORIES</strong></p>
<p>设置头文件包含目录。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">INCLUDE_DIRECTORIES</span><span class="p">(</span><span class="s">.</span> <span class="s">./src</span><span class="p">)</span> <span class="c">## 目录列表</span>
</pre></div>


<p><strong>ADD_SUBDIRECTORY</strong></p>
<p>指明本工程中还有一个子目录，当执行到此指令时，会进入到子目录中，使用子目录中的CMakeList进行构建。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">ADD_SUBDIRECTORY</span><span class="p">(</span><span class="s">sub_project_dir</span><span class="p">)</span>
</pre></div>


<p><strong>FILE</strong></p>
<p>文件相关的操作。支持通配符扩展。</p>
<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">FILE</span><span class="p">(</span><span class="s">GLOB_RECURSE</span> <span class="s">SRC_FILES</span> <span class="s">*.cpp</span> <span class="s">*.h</span><span class="p">)</span> <span class="c">## 获取当前处理的CMakeLists.txt文件所在目录及其子目录中所有的cpp文件和h文件，放到SRC_FILES变量里</span>
</pre></div>


<p>GLOB_RECURSE代表全局递归查找。</p>
<p><strong>ADD_EXECUTABLE</strong></p>
<p>设置生成一个可执行文件。通常位于次级CMakeLists.txt。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">ADD_EXECUTABLE</span><span class="p">(</span><span class="s">exefile</span> <span class="s">src_file_list</span><span class="p">)</span>
</pre></div>


<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">ADD_EXECUTABLE</span><span class="p">(</span><span class="s">main</span> <span class="s">main.c</span> <span class="s">t1.c</span> <span class="s">t2.c</span><span class="p">)</span>
</pre></div>


<p><strong>ADD_LIBRARY</strong></p>
<p>设置生成一个库文件。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">ADD_LIBRARY</span><span class="p">(</span><span class="s">libname</span> <span class="s">[SHARED</span> <span class="s">|</span> <span class="s">STATIC]</span> <span class="s">source_list</span><span class="p">)</span>
</pre></div>


<p>说明：</p>
<ul>
<li>libname无需加lib前缀和.so后缀</li>
<li>SHARED表示动态库，STATIC表示静态库，默认是静态库</li>
</ul>
<p><strong>LINK_DIRECTORIES和TARGET_LINK_LIBRARIES</strong></p>
<p>设置链接库的所在目录，设置目标所需要的链接库文件。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">LINK_DIRECTORIES</span><span class="p">(</span><span class="s">dir_list</span><span class="p">)</span>
<span class="nb">TARGET_LINK_LIBRARIES</span><span class="p">(</span><span class="s">target</span> <span class="s">lib_list</span><span class="p">)</span>
</pre></div>


<p>注：</p>
<ul>
<li>
<p>如果是共享库，可以不写前缀与后缀；如果是静态库，要写全名</p>
</li>
<li>
<p>TARGET_LINK_LIBRARIES命令要写在ADD_EXECUTABLE后面</p>
</li>
</ul>
<p><strong>STRING</strong></p>
<p>可以修改字符串，将其存到一个变量里。此变量可以事先没有SET。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">STRING</span><span class="p">(</span><span class="s">[TOLOWER</span> <span class="s">|</span> <span class="s">TOUPPER]</span> <span class="s">string</span> <span class="s">output_val</span><span class="p">)</span> <span class="c">## 将string转换成小写，赋给output_val</span>
</pre></div>


<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">STRING</span><span class="p">(</span><span class="s">TOLOWER</span> <span class="o">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="o">}</span> <span class="s">BUILD_TYPE</span><span class="p">)</span>
</pre></div>


<p><strong>source_group</strong></p>
<p>可以在 vs 中设置筛选器，里面包含指定的项目文件。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">source_group</span><span class="p">(</span><span class="s">&lt;name&gt;</span> <span class="s">[FILES</span> <span class="s">&lt;src&gt;...]</span> <span class="s">[REGULAR_EXPRESSION</span> <span class="s">&lt;regex&gt;]</span><span class="p">)</span>
<span class="nb">source_group</span><span class="p">(</span><span class="s">TREE</span> <span class="s">&lt;root&gt;</span> <span class="s">[PREFIX</span> <span class="s">&lt;prefix&gt;]</span> <span class="s">[FILES</span> <span class="s">&lt;src&gt;...]</span><span class="p">)</span>
</pre></div>


<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">source_group</span><span class="p">(</span><span class="s">src</span> <span class="s">FILES</span> <span class="o">${</span><span class="nv">SRC_FILES</span><span class="o">}</span><span class="p">)</span> <span class="c"># src 是筛选器的名字</span>
</pre></div>


<p>PS: 在vs2015下面经过测试发现，需要重新构建项目，这个指令才会生效。</p>
<p><strong>set_property</strong></p>
<p>在一个作用域内设置某属性的值。</p>
<p>指令语法：</p>
<div class="codehilite"><pre><span></span><span class="nb">set_property</span><span class="p">(</span><span class="s">&lt;GLOBAL</span>                            <span class="s">|</span>
              <span class="s">DIRECTORY</span> <span class="s">[dir]</span>                   <span class="s">|</span>
              <span class="s">TARGET</span>    <span class="s">[target1</span> <span class="s">[target2</span> <span class="s">...]]</span> <span class="s">|</span>
              <span class="s">SOURCE</span>    <span class="s">[src1</span> <span class="s">[src2</span> <span class="s">...]]</span>       <span class="s">|</span>
              <span class="s">INSTALL</span>   <span class="s">[file1</span> <span class="s">[file2</span> <span class="s">...]]</span>     <span class="s">|</span>
              <span class="s">TEST</span>      <span class="s">[test1</span> <span class="s">[test2</span> <span class="s">...]]</span>     <span class="s">|</span>
              <span class="s">CACHE</span>     <span class="s">[entry1</span> <span class="s">[entry2</span> <span class="s">...]]&gt;</span>
             <span class="s">[APPEND]</span> <span class="s">[APPEND_STRING]</span>
             <span class="s">PROPERTY</span> <span class="s">&lt;name&gt;</span> <span class="s">[value1</span> <span class="s">[value2</span> <span class="s">...]]</span><span class="p">)</span>
</pre></div>


<p>使用例子：</p>
<div class="codehilite"><pre><span></span><span class="nb">set_property</span><span class="p">(</span> <span class="s">DIRECTORY</span> <span class="s">PROPERTY</span> <span class="s">VS_STARTUP_PROJECT</span> <span class="s2">&quot;project&quot;</span> <span class="p">)</span> <span class="c"># 设置 vs 启动项目为 project</span>
</pre></div>


<p>DIRECTORY 默认使用当前的目录为作用域。</p>
<p><strong>add_custom_command</strong></p>
<p>设置一些自定义的命令。</p>
<p>例如，在生成前和生成后执行以下命令行的命令：</p>
<div class="codehilite"><pre><span></span><span class="c"># 生成前：更新一下 compileversion.cpp 文件，生成一个新的编译版本号</span>
<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">EXEgameworld_</span><span class="o">${</span><span class="nv">ARPG_BUILD_TYPE</span><span class="o">}</span>
    <span class="s">PRE_BUILD</span>
    <span class="s">COMMAND</span> <span class="s">echo</span> <span class="s">[PRE_BUILD]</span> <span class="s">Update</span> <span class="s">compileversion</span> <span class="s">for</span> <span class="s">gameworld</span>
    <span class="s">COMMAND</span> <span class="s">copy</span> <span class="s">/B</span> <span class="s">compileversion.cpp</span> <span class="s">+,,</span> <span class="s">&gt;</span> <span class="s">nul</span>
    <span class="s">COMMENT</span> <span class="s2">&quot;Update compileversion&quot;</span>
    <span class="s">WORKING_DIRECTORY</span> <span class="o">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="o">}</span><span class="s">/gameworld</span>
<span class="p">)</span>

<span class="c"># 生成完：将 EXEgameworld 拷贝到给 check_config</span>
<span class="nb">add_custom_command</span><span class="p">(</span><span class="s">TARGET</span> <span class="s">EXEgameworld_</span><span class="o">${</span><span class="nv">ARPG_BUILD_TYPE</span><span class="o">}</span>
    <span class="s">POST_BUILD</span>
    <span class="s">COMMAND</span> <span class="s">echo</span> <span class="s">[POST_BUILD]</span> <span class="s">copy</span> <span class="s">EXEgameworld</span> <span class="s">for</span> <span class="s">check_config</span>
    <span class="s">COMMAND</span> <span class="s">copy</span> <span class="s">vsproject\\Debug\\EXEgameworld_debug.exe</span> <span class="s">config\\server_opera_tools\\bin</span>
    <span class="s">WORKING_DIRECTORY</span> <span class="o">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="o">}</span><span class="s">/</span>
<span class="p">)</span>
</pre></div>


<h4 id="_5">一些内置变量</h4>
<p><strong>PROJECT_BINARY_DIR与PROJECT_SOURCE_DIR</strong></p>
<p>PROJECT_BINARY_DIR默认值是编译（make）发生的目录。</p>
<p>PROJECT_SOURCE_DIR是工程的顶层目录（顶层CMakeLists.txt所在目录）。</p>
<p><strong>EXECUTABLE_OUTPUT_PATH与LIBRARY_OUTPUT_PATH</strong></p>
<p>最终的目标二进制位置；最终的共享库位置。都不包含中间文件。</p>
<p>通常用SET命令设置，如：</p>
<div class="codehilite"><pre><span></span>SET<span class="o">(</span>EXECUTABLE_OUTPUT_PATH <span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span>/bin<span class="o">)</span>
SET<span class="o">(</span>LIBRARY_OUTPUT_PATH <span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span>/lib<span class="o">)</span>
</pre></div>


<p><strong>CMAKE_CXX_FLAGS</strong></p>
<p>C++编译选项。</p>
<p>另外还有：</p>
<ul>
<li>CMAKE_CXX_FLAGS, 默认选项</li>
<li>CMAKE_CXX_FLAGS_DEBUG，当CMAKE_BUILD_TYPE为Debug时启用</li>
<li>CMAKE_CXX_FLAGS_RELEASE，当CMAKE_BUILD_TYPE为Release时启用</li>
</ul>
<p><strong>CMAKE_CURRENT_SOURCE_DIR</strong></p>
<p>当前处理的CMakeLists.txt所在路径。</p>
<h2 id="_6">几个例子</h2>
<h3 id="_7">单项目工程</h3>
<div class="codehilite"><pre><span></span><span class="c1"># 要求 cmake 最低版本</span>
cmake_minimum_required<span class="o">(</span>VERSION <span class="m">2</span>.8 FATAL_ERROR<span class="o">)</span>

<span class="c1"># 设置工程名</span>
project<span class="o">(</span>project_name<span class="o">)</span>

<span class="c1"># 自定义变量</span>
set<span class="o">(</span>INCLUDE_DIR <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/include<span class="o">)</span>
set<span class="o">(</span>LINK_DIR <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/lib<span class="o">)</span>
set<span class="o">(</span>LIBS m<span class="o">)</span>

<span class="c1"># 设定编译选项</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS <span class="s2">&quot;-g -Wall -std=c++11&quot;</span><span class="o">)</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS_DEBUG <span class="s2">&quot;-g -Wall -std=c++11 -D_DEBUG&quot;</span><span class="o">)</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS_RELEASE <span class="s2">&quot;-g -Wall -std=c++11&quot;</span><span class="o">)</span>

<span class="c1"># 设定头文件包含目录</span>
include_directories<span class="o">(</span><span class="si">${</span><span class="nv">INCLUDE_DIR</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定链接目录</span>
link_directories<span class="o">(</span><span class="si">${</span><span class="nv">LINK_DIR</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定项目文件</span>
file<span class="o">(</span>GLOB_RECURSE SRC_FILES <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/src/*.cpp&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/src/*.h&quot;</span><span class="o">)</span>

<span class="c1"># 设定输出目录</span>
set<span class="o">(</span>EXECUTABLE_OUTPUT_PATH <span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span>/out<span class="o">)</span>

<span class="c1"># 设定可执行程序及生成它依赖的文件</span>
add_executable<span class="o">(</span>project_name <span class="si">${</span><span class="nv">SRC_FILES</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定可执行程序依赖的库</span>
target_link_libraries<span class="o">(</span>project_name <span class="si">${</span><span class="nv">LIBS</span><span class="si">}</span><span class="o">)</span>
</pre></div>


<h3 id="_8">多项目工程</h3>
<h4 id="cmakelists">顶层 CMakeLists</h4>
<div class="codehilite"><pre><span></span>cmake_minimum_required<span class="o">(</span>VERSION <span class="m">3</span>.5 FATAL_ERROR<span class="o">)</span>

<span class="c1"># 设置工程名</span>
project<span class="o">(</span>project_name<span class="o">)</span>

<span class="c1"># 自定义变量</span>
set<span class="o">(</span>INCLUDE_DIR <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/include<span class="o">)</span>
set<span class="o">(</span>LINK_DIR <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/lib<span class="o">)</span>
set<span class="o">(</span>LIBS m<span class="o">)</span>

<span class="c1"># 设置编译选项</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS <span class="s2">&quot;-g -Wall -std=c++11&quot;</span><span class="o">)</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS_DEBUG <span class="s2">&quot;-g -Wall -std=c++11 -D_DEBUG&quot;</span><span class="o">)</span>
set<span class="o">(</span>CMAKE_CXX_FLAGS_RELEASE <span class="s2">&quot;-g -Wall -std=c++11&quot;</span><span class="o">)</span>

<span class="c1"># 设定头文件包含目录</span>
include_directories<span class="o">(</span><span class="si">${</span><span class="nv">INCLUDE_DIR</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定链接目录</span>
link_directories<span class="o">(</span><span class="si">${</span><span class="nv">LINK_DIR</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定输出目录</span>
set<span class="o">(</span>EXECUTABLE_OUTPUT_PATH <span class="si">${</span><span class="nv">PROJECT_BINARY_DIR</span><span class="si">}</span>/out<span class="o">)</span>

<span class="c1"># 引入子项目</span>
add_subdirectory<span class="o">(</span>program<span class="o">)</span>
</pre></div>


<h4 id="cmakelists_1">子项目 CMakeLists</h4>
<div class="codehilite"><pre><span></span><span class="c1"># 自定义变量</span>
set<span class="o">(</span>PROGRAM_INCLUDE_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/include<span class="o">)</span>

<span class="c1"># 设定头文件包含目录</span>
include_directories<span class="o">(</span><span class="si">${</span><span class="nv">INCLUDE_DIR</span><span class="si">}</span> <span class="si">${</span><span class="nv">PROGRAM_INCLUDE_DIR</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设定项目文件</span>
file<span class="o">(</span>GLOB_RECURSE SRC_FILES <span class="s2">&quot;*.cpp&quot;</span> <span class="s2">&quot;*.h&quot;</span><span class="o">)</span>

<span class="c1"># 设置可执行程序依赖的文件</span>
add_executable<span class="o">(</span>program_<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span> <span class="si">${</span><span class="nv">SRC_FILES</span><span class="si">}</span><span class="o">)</span>

<span class="c1"># 设置可执行程序依赖的库</span>
target_link_libraries<span class="o">(</span>program_<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span> <span class="si">${</span><span class="nv">LIBS</span><span class="si">}</span><span class="o">)</span>
</pre></div>


<h3 id="_9">一个采取外部构建的脚本</h3>
<div class="codehilite"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="c1"># usage: $ sh build.sh [rebuild | clear]</span>

clear<span class="o">()</span>
<span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> ! -d tmp_build <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">fi</span>

    <span class="nb">cd</span> tmp_build
    make clean
    <span class="nb">cd</span> ..
    rm -rf tmp_build
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;rebuild&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    clear
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;clear&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    clear
    <span class="nb">exit</span>
<span class="k">fi</span>

mkdir -p tmp_build
<span class="nb">cd</span> tmp_build

cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>debug ..
<span class="nb">time</span> make -j4
</pre></div>


<h2 id="_10">参考资料</h2>
<p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-cmake/index.html">在 linux 下使用 CMake 构建应用程序</a></p>
<p><a href="https://cmake.org">官方网站</a></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; since 2018 Diwen Liu</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
