# 调试

---

## 错误类型

- 功能定义错误：要理解程序究竟是干什么的，让功能正确。

- 设计规划错误：一定要花时间思考如何构造程序，这可以节省今后改代码的时间。

- 代码编写错误：与他人多沟通，是发现错误的有效方法。

可以试着在纸上写下执行程序的代码，这个过程称为空运行（ dry running ）。针对非常重要的例程，先记下其输入，然后手工计算其输出。调试程序不一定非要用计算机。

## 常用调试技巧

程序调试可以分为如下阶段：

- 测试：找出程序中存在的缺陷或错误

- 固化：让程序的错误可重现

- 定位：确定相关的代码行

- 纠正：修改代码纠正错误

- 验证：确定修改解决了问题

### 代码检查

有些工具可以帮你完成代码检查工作，编译器就是其中比较明显的一个。如果有语法错误，它会告诉你。

```
gcc -Wall -pedantic -ansi
```

-Wall 打开了所有的语法警告，-pedantic 检查语法是否符合 ANSI/ISO 标准，-ansi 表示使用的是C89 。

### 取样法

取样法是指在程序中添加一些代码以收集更多与程序运行时的行为相关的信息的方法。取样法的常见做法是，在程序中添加 printf 函数来打印不同阶段的值。

但这种做法会带来更多的编辑和编译，在程序的错误修复后，需要把这些额外的代码删除掉。

或者使用这样的方法来包含调试代码：

```c
#ifdef DEBUG
    printf("variable x has value = %d\n", x);
#endif
```

在编译程序时，加上编译标志 -DDEBUG 就可以启用这个代码。甚至可以设置一个调试级别：

```c
#define BASIC_DEBUG 1
#define EXTRA_DEBUG 2
#define SUPER_DEBUG 4

#if (DEBUG & EXTRA_DEBUG)
    printf...
#endif
```

这时候可以给 DEBUG 设置一个值来和某个 DEBUG 级别做位与操作： -DDEBUG=5 将启用 BASIC_DEBUG 和 SUPER_DEBUG 。

将其设置为0则代表关闭所有调试信息。

C语言还提供了一些宏帮助我们进行调试。比如：`__LINE__`, `__FILE__`, `__DATE__`, `__TIME__` 。