



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Linux Study Note">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>ch03 文件操作 - Linux Study Note</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Open+Sans+Mono">
        <style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Open Sans Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Linux Study Note" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Linux Study Note
              </span>
              <span class="md-header-nav__topic">
                ch03 文件操作
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/demon90s/LinuxStudy/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Linux Study Note" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    Linux Study Note
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/demon90s/LinuxStudy/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Chapters
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Chapters
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ch01 入门/" title="ch01 入门" class="md-nav__link">
      ch01 入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch02 shell程序设计/" title="ch02 shell程序设计" class="md-nav__link">
      ch02 shell程序设计
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ch03 文件操作
      </label>
    
    <a href="./" title="ch03 文件操作" class="md-nav__link md-nav__link--active">
      ch03 文件操作
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" title="Linux文件结构" class="md-nav__link">
    Linux文件结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="目录" class="md-nav__link">
    目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="文件和设备" class="md-nav__link">
    文件和设备
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="系统调用和设备驱动程序" class="md-nav__link">
    系统调用和设备驱动程序
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="库函数" class="md-nav__link">
    库函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="底层文件访问" class="md-nav__link">
    底层文件访问
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write" title="write系统调用" class="md-nav__link">
    write系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" title="read系统调用" class="md-nav__link">
    read系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open" title="open系统调用" class="md-nav__link">
    open系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="访问权限的初始值" class="md-nav__link">
    访问权限的初始值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="其他与文件管理有关的系统调用" class="md-nav__link">
    其他与文件管理有关的系统调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io" title="标准I/O库" class="md-nav__link">
    标准I/O库
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" title="格式化输入和输出" class="md-nav__link">
    格式化输入和输出
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="文件和目录的维护" class="md-nav__link">
    文件和目录的维护
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="扫描目录" class="md-nav__link">
    扫描目录
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="错误处理" class="md-nav__link">
    错误处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proc" title="/proc 文件系统" class="md-nav__link">
    /proc 文件系统
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fcntlmap" title="高级主题：fcntl和map" class="md-nav__link">
    高级主题：fcntl和map
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch04 Linux环境/" title="ch04 Linux环境" class="md-nav__link">
      ch04 Linux环境
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch05 终端/" title="ch05 终端" class="md-nav__link">
      ch05 终端
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch06 curses/" title="ch06 curses" class="md-nav__link">
      ch06 curses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch07 数据管理/" title="ch07 数据管理" class="md-nav__link">
      ch07 数据管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch08 MySQL/" title="ch08 MySQL" class="md-nav__link">
      ch08 MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch09 开发工具/" title="ch09 开发工具" class="md-nav__link">
      ch09 开发工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch10 调试/" title="ch10 调试" class="md-nav__link">
      ch10 调试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch11 进程和信号/" title="ch11 进程和信号" class="md-nav__link">
      ch11 进程和信号
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch12 POSIX线程/" title="ch12 POSIX线程" class="md-nav__link">
      ch12 POSIX线程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch13 进程间通信_管道/" title="ch13 进程间通信_管道" class="md-nav__link">
      ch13 进程间通信_管道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch14 信号量_共享内存和消息队列/" title="ch14 信号量_共享内存和消息队列" class="md-nav__link">
      ch14 信号量_共享内存和消息队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch15 套接字/" title="ch15 套接字" class="md-nav__link">
      ch15 套接字
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch16 用GTK+进行GNOME编程/" title="ch16 用GTK+进行GNOME编程" class="md-nav__link">
      ch16 用GTK+进行GNOME编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ch17 用Qt进行KDE编程/" title="ch17 用Qt进行KDE编程" class="md-nav__link">
      ch17 用Qt进行KDE编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      CheatSheet
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CheatSheet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/shell_utility/" title="shell_utility" class="md-nav__link">
      shell_utility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/MySQL操作/" title="MySQL操作" class="md-nav__link">
      MySQL操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/Bash-HowTo/" title="Bash HowTo" class="md-nav__link">
      Bash HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/CentOS7-HowTo/" title="CentOS7 HowTo" class="md-nav__link">
      CentOS7 HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/Ubuntu-HowTo/" title="Ubuntu HowTo" class="md-nav__link">
      Ubuntu HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/subversion-HowTo/" title="subversion HowTo" class="md-nav__link">
      subversion HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/GDB-HowTo/" title="GDB HowTo" class="md-nav__link">
      GDB HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cheatsheet/cmake-HowTo/" title="cmake HowTo" class="md-nav__link">
      cmake HowTo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" title="Linux文件结构" class="md-nav__link">
    Linux文件结构
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="目录" class="md-nav__link">
    目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="文件和设备" class="md-nav__link">
    文件和设备
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="系统调用和设备驱动程序" class="md-nav__link">
    系统调用和设备驱动程序
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="库函数" class="md-nav__link">
    库函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="底层文件访问" class="md-nav__link">
    底层文件访问
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write" title="write系统调用" class="md-nav__link">
    write系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" title="read系统调用" class="md-nav__link">
    read系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open" title="open系统调用" class="md-nav__link">
    open系统调用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="访问权限的初始值" class="md-nav__link">
    访问权限的初始值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="其他与文件管理有关的系统调用" class="md-nav__link">
    其他与文件管理有关的系统调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io" title="标准I/O库" class="md-nav__link">
    标准I/O库
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" title="格式化输入和输出" class="md-nav__link">
    格式化输入和输出
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="文件和目录的维护" class="md-nav__link">
    文件和目录的维护
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="扫描目录" class="md-nav__link">
    扫描目录
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" title="错误处理" class="md-nav__link">
    错误处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proc" title="/proc 文件系统" class="md-nav__link">
    /proc 文件系统
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fcntlmap" title="高级主题：fcntl和map" class="md-nav__link">
    高级主题：fcntl和map
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/demon90s/LinuxStudy/tree/master/study_notes/markdowns/ch03 文件操作.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="_1">第三章 文件操作</h1>
<hr />
<h2 id="linux">Linux文件结构</h2>
<p>Linux环境中的文件具有特别重要的意义，因为它们为操作系统服务和设备提供了一个简单而一致的接口。在Linux中，<strong>一切（或几乎一切）都是文件</strong>。</p>
<p>这就意味着，通常程序完全可以像使用文件那样使用磁盘文件、串行口、打印机和其他设备。大多数情况下，你只需要使用5个基本的函数——open、close、read、write和ioctl。</p>
<p>目录是一种特殊类型的文件，在现代的UNIX（包括Linux）版本中，即使是超级用户可能也不再被允许直接对目录进行写操作了。所有用户通常使用上层的opendir/readdir接口来读取目录。</p>
<h3 id="_2">目录</h3>
<p>文件，除了本身包含的内容以外，它还会有一个名字和一些属性。这些属性被保存在文件的inode（节点）中，它是文件系统中的一个特殊的数据块，它同时还包含文件的长度和文件在磁盘上的存放位置。系统使用的是文件的inode编号，目录结构为文件命名仅仅是为了便于人们使用。</p>
<p>目录是用于保存其他文件的节点号和名字的文件。目录文件中的每个数据项都是指向某个文件节点的链接，删除文件名就等于删除与之对应的链接（文件的节点号可以通过ls -i命令查看）。你可以通过使用ln命令在不同的目录中创建指向同一个文件的链接。</p>
<hr />
<p><strong>【my note】</strong></p>
<p>假如有一个文件名为foo.txt，然后执行：</p>
<div class="codehilite"><pre><span></span>$ ln foo2.txt foo.txt <span class="c1">## 如此一来，foo2.txt和foo.txt将是同一个文件</span>
$ ls -il foo*
</pre></div>


<p>可以看到，这两个文件的节点号是一致的，且链接数都是2。</p>
<hr />
<p>删除一个文件时，实质上是删除了该文件对应的目录项，同时指向该文件的链接数减1。如果指向某个文件的链接数（即ls -l命令输出中跟在访问权限后面的那个数字）变为0，就表示该节点以及其指向的数据不再被使用，磁盘上的相应位置就会被标记为可用空间。</p>
<p>文件被安排在目录中，目录中可能还包含子目录。这就构成了文件系统层次结构。如图：</p>
<p><img alt="目录结构" src="../image/目录结构.png" /></p>
<h3 id="_3">文件和设备</h3>
<p>硬件设备在Linux中通常也被表示（映射）为文件。例如，作为超级用户，你可以使用如下命令将IDE CD-ROM驱动器挂载为一个文件：</p>
<div class="codehilite"><pre><span></span># mount -t iso9660 /dev/hdc /mnt/cdrom
# cd /mnt/cdrom
</pre></div>


<p>这个命令将CD-ROM设备中的当前内容挂载为/mnt/cdrom目录下的文件结构。然后，你就可以像往常一样浏览CD-ROM的目录，只不过其内容是只读的。</p>
<hr />
<p><strong>【my note】</strong></p>
<p>我使用的是安装在虚拟机里的CentOS 7，挂载的方法是：先打开虚拟机设置-&gt;存储，把iso镜像添加成IDE，然后输入命令：</p>
<div class="codehilite"><pre><span></span># mkdir -p /mnt/cdrom
# mount -t iso9660 /dev/cdrom /mnt/cdrom
</pre></div>


<p>卸载的命令是：</p>
<div class="codehilite"><pre><span></span># umount /mnt/cdrom
</pre></div>


<hr />
<p>UNIX和Linux众比较重要的设备文件有3个：/dev/console、/dev/tty和/dev/null</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>书上讲的概念性比较强，读到此处时还没能完全理解（除了/dev/null比较好理解），所以还是看书吧。</p>
</div>
<p>设备被分为字符设备和块设备，两者的区别在于访问设备时是否需要一次读写一整块。比如硬盘就是一个块设备。</p>
<h2 id="_4">系统调用和设备驱动程序</h2>
<p>系统调用函数，由Linux直接提供，它们是通向操作系统本身的接口。</p>
<p>操作系统的核心部分，即内核，是一组设备驱动程序。它们是一组对系统硬件进行控制的底层接口。</p>
<p>下面是用于访问设备驱动程序的底层函数（系统调用）。</p>
<ul>
<li>
<p>open：打开文件或设备。</p>
</li>
<li>
<p>read：从打开的文件或设备里读数据。</p>
</li>
<li>
<p>write：向文件或设备写数据。</p>
</li>
<li>
<p>close：关闭文件或设备。</p>
</li>
<li>
<p>ioctl：把控制信息传递给设备驱动程序。</p>
</li>
</ul>
<p>系统调用ioctl用于提供一些与特定硬件设备有关的必要控制（与正常的输入输出相反），所以它的用法随设备的不同而不同。</p>
<p>系统调用的文档一般放在手册页的第二节。</p>
<h2 id="_5">库函数</h2>
<p>针对输入输出操作直接使用底层系统调用的一个问题是它们的效率非常低。为什么呢？</p>
<ul>
<li>
<p>使用系统调用会影响系统的性能。与函数调用相比，系统调用的开销要大些，因为在执行系统调用时，Linux必须从运行用户代码切换到执行内核代码，然后再返回用户代码。</p>
</li>
<li>
<p>硬件会限制对底层系统调用一次所能读写的数据块大小。</p>
</li>
</ul>
<p>为了给设备和磁盘文件提供更高层的接口，Linux发行版提供了一系列的标准库函数。你可以高效地写任意长度的数据块，库函数则在数据满足数据块长度要求时安排执行底层系统调用。这就极大降低了系统调用的开销。</p>
<p>库函数的文档一般放在手册页的第三节。</p>
<p>下图显示了Linux系统中各种文件函数与用户、设备驱动程序、内核和硬件之间的关系。</p>
<p><img alt="库函数" src="../image/库函数.png" /></p>
<h2 id="_6">底层文件访问</h2>
<p>每个运行中的程序被称为<strong>进程</strong>（process），它有一些与之关联的文件描述符。这是一些小值整数，你可以通过它们访问文件或设备。当一个程序开始运行时，它一般会有3个已经打开的文件描述符：</p>
<ul>
<li>
<p>0：标准输入</p>
</li>
<li>
<p>1：标准输出</p>
</li>
<li>
<p>2：标准错误</p>
</li>
</ul>
<p>你可以通过系统调用open把其他文件描述符与文件和设备相关联。</p>
<h3 id="write">write系统调用</h3>
<p>系统调用 <a href="../../codes/lab/api/文件操作/write.c">write</a> 的作用是把缓冲区buf的前nbytes个字节写入与文件描述符fildes关联的文件中。它返回实际写入的字节数。如果文件描述符有错或者底层设备驱动程序对数据块长度比较敏感，该返回值可能会小于nbytes。如果这个函数返回0，就表示未写入任何数据；如果返回-1，就表示出现了错误，错误代码保存到全局变量errno里。</p>
<div class="codehilite"><pre><span></span>#include &lt;unistd.h&gt;

ssize_t write(int fd, const void *buf, size_t count);
</pre></div>


<p>当程序退出运行时，所有已经打开的文件描述符都会自动关闭，所以你不需要明确地关闭它们。但处理被缓冲的输出时，情况就不一样了。</p>
<h3 id="read">read系统调用</h3>
<p>系统调用 <a href="../../codes/lab/api/文件操作/read.c">read</a> 的作用是：从与文件描述符fildes相关联的文件里读入nbytes个字节的数据，并把它们放到数据区buf中。它返回实际读入的字节数，这可能会小于请求的字节数。如果read调用返回0，就表示未读入任何数据，已达到文件尾。如果返回-1，就表示出现了错误。</p>
<div class="codehilite"><pre><span></span>#include &lt;unistd.h&gt;

ssize_t read(int fd, void *buf, size_t count);
</pre></div>


<h3 id="open">open系统调用</h3>
<p>为了创建一个新的文件描述符，你需要使用系统调用 <a href="../../codes/lab/api/文件操作/open.c">open</a> 。</p>
<div class="codehilite"><pre><span></span>#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;

int open(const char *pathname, int flags);
int open(const char *pathname, int flags, mode_t mode);

int creat(const char *pathname, mode_t mode);
</pre></div>


<p>简单的说，open建立了一条到文件或设备的访问路径。如果调用成功，它将返回一个可以被read、write和其他系统调用使用的文件描述符。这个文件描述符是唯一的，它不会与任何其他运行中的进程共享。</p>
<p>oflags参数用于指定打开文件所采取的动作。它是通过命令文件访问模式与其他可选模式相结合的方式来指定的。open调用必须是以下文件访问模式之一：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>O_RDONLY</td>
<td>以只读方式打开</td>
</tr>
<tr>
<td>O_WRONLY</td>
<td>以只写方式打开</td>
</tr>
<tr>
<td>O_RDWR</td>
<td>以读写方式打开</td>
</tr>
</tbody>
</table>
<p>open调用还可以在oflags参数中包括下列可选模式的组合（用“按位或”操作）。</p>
<ul>
<li>O_APPEND：把写入的数据追加在文件的末尾。</li>
<li>O_TRUNC：把文件的长度设置为0，丢弃已有的内容。</li>
<li>O_CREAT：如果需要，就按照参数mode中给出的访问模式创建文件。</li>
<li>O_EXCL：与O_CREAT一起使用，确保调用者创建出文件。Open调用是一个原子操作，也就是说，它只执行一次函数调用。使用这个可选模式可以防止两个程序同时创建同一个文件。如果文件已存在，open调用将失败。</li>
</ul>
<p>open调用失败返回-1并设置errno。新的文件描述符总是使用未用描述符的最小值。</p>
<p>POSIX规范还标准化了一个creat调用，它不仅会像预期那样创建文件，还会打开文件。相当于以oflags标志<code>O_CREAT|O_WRONLY|O_TRUNC</code>来调用open。</p>
<p>任何一个运行中的程序能够打开的文件数是有限制的，这个限制通常是由limits.h头文件中的常量OPEN_MAX定义的，POSIX要求它至少为16。在Linux系统中，这个限制可以在系统运行时调整。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在我的CentOS 7中，这个变量叫做FOPEN_MAX，其值为16。<code>/usr/include/bits/stdio_lim.h:## define FOPEN_MAX 16</code>，真实可以打开的文件描述符数量远高于这个值，见<a href="../../codes/lab/test_OPEN_MAX.c">测试代码</a></p>
</div>
<h3 id="_7">访问权限的初始值</h3>
<p>当使用带有O_CREAT标志的open调用来创建文件时，必须使用有3个参数格式的open调用。第三个参数mode是几个标志按位或后得到的，这些标志有：</p>
<ul>
<li>S_IRUSR：读权限，文件属主</li>
<li>S_IWUSR：写权限，文件属主</li>
<li>S_IXUSR：执行权限，文件属主</li>
<li>S_IRGRP：读权限，文件所属组</li>
<li>S_IWGRP：写权限，文件所属组</li>
<li>S_IXGRP：执行权限，文件所属组</li>
<li>S_IROTH：读权限，其他用户</li>
<li>S_IWOTH：写权限，其他用户</li>
<li>S_IXOTH：执行权限，其他用户</li>
</ul>
<p>用户掩码（由umask命令指定）会影响到被创建文件的访问权限。open调用里给出的mode值将与当时的用户掩码的反值做AND操作。</p>
<div class="codehilite"><pre><span></span>用户掩码中指定了不允许向某类用户提供的权限：
4 - 写
2 - 读
1 - 执行
因此，若 umask 的执行结果为 
0002
-ugo
则代表对于其他用户(o)，将没有读权限。
</pre></div>


<p><strong>close系统调用</strong></p>
<p>可以使用close调用终止文件描述符与其对应文件之间的关联。文件描述符被释放并能够重新使用。close调用成功时返回0，出错时返回-1。</p>
<div class="codehilite"><pre><span></span>#include &lt;unistd.h&gt;

int close(int fd);
</pre></div>


<p><strong>ioctl系统调用</strong></p>
<p><a href="../../codes/lab/api/文件操作/ioctl.c">ioctl</a> 提供了一个用于控制设备及其描述符行为和配置底层服务的接口。</p>
<div class="codehilite"><pre><span></span>#include &lt;sys/ioctl.h&gt;

int ioctl(int fd, int cmd, ...);
</pre></div>


<p>ioctl对描述符fd引用的对象执行cmd参数中给出的操作。根据特定设备所支持操作的不同，它还可能会有一个可选的第三参数。</p>
<h3 id="_8">其他与文件管理有关的系统调用</h3>
<p><strong>lseek系统调用</strong></p>
<p>lseek系统调用对文件描述符的读写指针进行设置。也就是说，可以用它来设置文件的下一个读写位置。</p>
<div class="codehilite"><pre><span></span>#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

off_t lseek(int fd, off_t offset, int whence);
</pre></div>


<p>offset参数用来指定位置，whence参数定义该偏移值的用法。whence可以取下列值之一：</p>
<ul>
<li>SEEK_SET: offset是一个绝对位置。</li>
<li>SEEK_CUR: offset是相对于当前位置的一个相对位置。</li>
<li>SEEK_END: offset是相对于文件尾的一个相对位置。</li>
</ul>
<p>lseek返回从文件头到文件指针被设置处的字节偏移值，失败时返回-1。参数offset的类型off_t是一个与具体实现有关的整数类型。</p>
<p><strong>fstat, stat和lstat系统调用</strong></p>
<p>fstat系统调用返回与打开的文件描述符和相关文件的状态信息，该信息将会写到一个buf结构中，buf的地址以参数形式传递给fstat。</p>
<div class="codehilite"><pre><span></span>#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;

int stat(const char *path, struct stat *buf);
int fstat(int fd, struct stat *buf);
int lstat(const char *path, struct stat *buf);
</pre></div>


<p>相关函数stat和lstat返回的是通过文件名查询的状态信息。它们产生相同的结果，但当文件是一个符号链接时，lstat返回的是该符号链接本身的信息，而stat返回的是该链接指向的文件的信息。</p>
<p>参考 <a href="../../codes/lab/api/文件操作/fstat_stat_lstat.c">测试代码</a></p>
<p><strong>dup和dup2系统调用</strong></p>
<p>dup 系统调用提供了一种复制文件描述符的方法，使我们能够通过两个或者更多不同的描述符来访问同一个文件。</p>
<p>参考 <a href="../../codes/lab/api/dup.c">测试代码</a></p>
<h2 id="io">标准I/O库</h2>
<p>略。</p>
<h2 id="_9">格式化输入和输出</h2>
<p>略。</p>
<h2 id="_10">文件和目录的维护</h2>
<p><strong>chmod</strong> 可以修改文件或目录的访问权限。</p>
<p><strong>chown</strong> 改变一个文件的属主。</p>
<p><strong>unlink</strong> 用来删除一个文件的目录项，并减少它的链接数。你必须拥有其所属目录的写和执行权限。如果一个文件的链接数减少到零，并且没有进程打开它，这个文件就会被删除。 rm 程序就是使用这个调用。</p>
<p><strong>link</strong> 在程序中创建一个文件的新链接。</p>
<p><strong>symlink</strong> 系统调用创建一个文件的符号链接。符号链接不会增加文件的链接数。</p>
<p><strong>mkdir 和 rmdir</strong> 用来建立和删除目录。</p>
<p><strong>chdir</strong> 可以像 cd 一样切换目录。</p>
<p><strong>getcwd</strong> 获取当前的目录。</p>
<h2 id="_11">扫描目录</h2>
<p>Linux 系统上的一个常见问题就是扫描目录，在 shell 程序设计中，这很容易，使用通配符扩展即可做到。</p>
<p>使用相关的函数也可以处理。</p>
<p><a href="../../codes/lab/api/文件操作/opendir_closedir.c">opendir 和 closedir</a> 用来打开、关闭一个目录流，目录流类似文件流，可以用来读取目录项目。一个目录项就是一个目录或者一个文件。</p>
<p><a href="../../codes/lab/api/文件操作/readdir.c">readdir</a> 用来读取当前目录流中的一个目录项。</p>
<p>telldir 和 seekdir 用来获取、设置当前目录流的读曲位置。</p>
<h2 id="_12">错误处理</h2>
<p>略。</p>
<h2 id="proc">/proc 文件系统</h2>
<p>Linux 将一切事物都看作文件，硬件设备在文件系统中也有相应的条目。我们使用底层系统调用，通过 /dev 目录中的文件来访问硬件。</p>
<p>Linux 提供了一个特殊的文件系统 procfs ，它通常以 /proc 目录的形式呈现。该目录中包含了许多特殊文件用来对驱动程序和内核信息进行更高层的访问。</p>
<p>在多数情况下，只需要直接读取这些文件就可以获得状态信息。例如，可以这一给出 cpu 的详细信息：</p>
<div class="codehilite"><pre><span></span>$ cat /proc/cpuinfo
</pre></div>


<p>给出内存使用情况：</p>
<div class="codehilite"><pre><span></span>$ cat /proc/meminfo
</pre></div>


<p>给出内核版本信息：</p>
<div class="codehilite"><pre><span></span>$ cat /proc/version
</pre></div>


<p>还有一些条目不仅可以被读取，还可以被修改，但要特别小心。</p>
<p>/proc 目录中以数字命名的子目录用于提供正在运行的程序信息。</p>
<h2 id="fcntlmap">高级主题：fcntl和map</h2>
<p>fcntl 用于对底层文件描述符提供更多的操纵方法。</p>
<p><a href="../../codes/ch03_文件操作/mmap.c">mmap</a> 建立一段可以被两个或更多程序读写的内存。这一功能还可以用在文件处理上。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ch02 shell程序设计/" title="ch02 shell程序设计" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                ch02 shell程序设计
              </span>
            </div>
          </a>
        
        
          <a href="../ch04 Linux环境/" title="ch04 Linux环境" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                ch04 Linux环境
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; since 2018 Diwen Liu
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
        <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-XXXXXXXX-X","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(a){a.host!=document.location.host&&a.addEventListener("click",function(){var e=a.getAttribute("data-md-action")||"follow";ga("send","event","outbound",e,a.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
  </body>
</html>