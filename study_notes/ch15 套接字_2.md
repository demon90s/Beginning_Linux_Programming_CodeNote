# 网络信息

可以将自己的服务添加到/etc/services文件中的已知服务列表中，使用户可以使用符号化的服务名而不是端口号的数组。

如果给定一个主机名字，可以通过调用解析地址的主机数据库函数来确定它的IP地址。这些函数通过查询网络配置文件来完成这一工作，如/etc/services文件或网络信息服务（比如NIS, DNS）。

```
#include <netdb.h>

struct hostent *gethostbyname(const char *name);

struct hostent *gethostbyaddr(const void *addr, socklen_t len, int type);
```

这些函数返回的结构中至少包含以下几个成员：

```
struct hostent {
    char  *h_name;            /* official name of host */
    char **h_aliases;         /* alias list */
    int    h_addrtype;        /* host address type */
    int    h_length;          /* length of address */
    char **h_addr_list;       /* list of addresses */
};
```

如果查询失败，返回空指针。

与服务及其关联端口号有关的信息可以通过一些服务信息函数来获取。

```
#include <netdb.h>

struct servent *getservbyname(const char *name, const char *proto);

struct servent *getservbyport(int port, const char *proto);
```

proto参数用于指定连接该服务的协议，它的两个取值是tcp和udp。

结构servent至少包含以下几个成员：

```
struct servent {
    char  *s_name;       /* official service name */
    char **s_aliases;    /* alias list */
    int    s_port;       /* port number */
    char  *s_proto;      /* protocol to use */
}
```

函数inet_ntoa将一个因特网主机地址转换为一个点分四元组格式的字符串。

```
#include <arpa/inet.h>

char *inet_ntoa(struct in_addr in);
```

gethostname函数将当前主机的名字写入name指向的字符串中。

```
#include <unistd.h>

int gethostname(char *name, size_t len);
```

主机名将以null结尾。len指定了字符串name的长度，如果返回的主机名太长，它就会被截断。成功返回0，失败返回-1。

## 因特网守护进程（xinetd/inetd）

Unix系统通常以超级服务器的方式来提供多项网络服务。

超级服务器程序（因特网守护进程xinetd或inetd）同时监听许多端口地址上的连接。当有客户连接到某项服务时，守护进程就运行相应的服务器。这使得针对各项网络服务的服务器不需要一直运行着，它们可以在需要时启动。

我使用的CentOS 7中默认没有安装xinetd，因此需要先安装：

```
# yum install xinetd
```

接着去这个目录修改某一个服务的配置文件，比如daytime：/etc/xinetd.d

把配置文件中的disable选项的值设置成no，代表开启。

然后启动xinetd：

```
# systemctl start xinetd
```

其它细节见书本。

## 套接字选项

可以用许多选项来控制套接字的行为，可以使用setsockopt函数用于控制这些选项。

```
#include <sys/socket.h>

int setsockopt(int socket, int level, int option_name, const void *option_value, size_t option_len);
```

可以在协议层次的不同级别对选项进行设置。如果想要在套接字级别设置选项，就必须将level参数设置为SOL_SOCKET。

option_name参数指定要设置的选项；option_value参数的长度为option_len字节，它用于设置选项的新值。

setsockopt在成功时返回0，失败时返回-1。

详细细节见书本。不过书本也是略微介绍而已。