<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>ch16 用GTK+进行GNOME编程 - Linux Study Note</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-XXXXXXXX-X', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Linux Study Note</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Introduction</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapters <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../ch01 入门/">ch01 入门</a>
</li>
                                    
<li >
    <a href="../ch02 shell程序设计/">ch02 shell程序设计</a>
</li>
                                    
<li >
    <a href="../ch03 文件操作/">ch03 文件操作</a>
</li>
                                    
<li >
    <a href="../ch04 Linux环境/">ch04 Linux环境</a>
</li>
                                    
<li >
    <a href="../ch05 终端/">ch05 终端</a>
</li>
                                    
<li >
    <a href="../ch06 curses/">ch06 curses</a>
</li>
                                    
<li >
    <a href="../ch07 数据管理/">ch07 数据管理</a>
</li>
                                    
<li >
    <a href="../ch08 MySQL/">ch08 MySQL</a>
</li>
                                    
<li >
    <a href="../ch09 开发工具/">ch09 开发工具</a>
</li>
                                    
<li >
    <a href="../ch10 调试/">ch10 调试</a>
</li>
                                    
<li >
    <a href="../ch11 进程和信号/">ch11 进程和信号</a>
</li>
                                    
<li >
    <a href="../ch12 POSIX线程/">ch12 POSIX线程</a>
</li>
                                    
<li >
    <a href="../ch13 进程间通信_管道/">ch13 进程间通信_管道</a>
</li>
                                    
<li >
    <a href="../ch14 信号量_共享内存和消息队列/">ch14 信号量_共享内存和消息队列</a>
</li>
                                    
<li >
    <a href="../ch15 套接字/">ch15 套接字</a>
</li>
                                    
<li class="active">
    <a href="./">ch16 用GTK+进行GNOME编程</a>
</li>
                                    
<li >
    <a href="../ch17 用Qt进行KDE编程/">ch17 用Qt进行KDE编程</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">CheatSheet <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../cheatsheet/errno/">errno</a>
</li>
                                    
<li >
    <a href="../cheatsheet/git_github-HowTo/">Git-GitHub HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/Bash-HowTo/">Bash HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/CentOS7-HowTo/">CentOS7 HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/Ubuntu-HowTo/">Ubuntu HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/subversion-HowTo/">subversion HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/GDB-HowTo/">GDB HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/cmake-HowTo/">cmake HowTo</a>
</li>
                                    
<li >
    <a href="../cheatsheet/ssh-HowTo/">ssh HowTo</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../ch15 套接字/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ch17 用Qt进行KDE编程/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/demon90s/LinuxStudy/tree/master/notes/ch16 用GTK+进行GNOME编程.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#gtkgnome">第十六章 用GTK+进行GNOME编程</a></li>
            <li><a href="#x">X视窗系统简介</a></li>
            <li><a href="#gtk">GTK+简介</a></li>
            <li><a href="#_2">事件、信号和回调函数</a></li>
            <li><a href="#_3">组装盒构件</a></li>
            <li><a href="#gtk_2">Gtk+构件</a></li>
            <li><a href="#gnome_1">GNOME 构件</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="gtkgnome">第十六章 用GTK+进行GNOME编程</h1>
<p>Linux 中所有的 GUI 库都基于被称作X视窗系统的底层视窗系统。</p>
<p>在编写本章节的代码时，需要安装好相应的库。</p>
<hr />
<h2 id="x">X视窗系统简介</h2>
<p>X是一个开源的图形化系统。X没有定义用户界面，但提供了创建用户界面的手段。这意味这可以自由地创建自己的整个桌面环境。</p>
<p>两个桌面项目逐渐浮现成为了 Linux 用户的最爱： GNOME 和 KDE 。</p>
<p>X视窗系统被分别称为硬件级和应用程序级组件，它们分别被称为X服务器和X客户端。这些组件使用X协议进行通信。</p>
<h3 id="x_1">X服务器</h3>
<p>X服务器运行在用户的本地机器上，它在屏幕上完成低层的绘图操作。X服务器直接与显卡交互。</p>
<p>X服务器通过鼠标和键盘监听用户输入，并将键盘按键和鼠标点击传输给X客户端应用程序。这些信息被称为事件（ event ）。</p>
<h3 id="x_2">X客户端</h3>
<p>X客户端是以X视窗系统作为 GUI 的任何程序。例如 xterm 。通常情况下，X客户端等候X服务器传送用户事件，然后通过给X服务器发送重绘消息来响应，</p>
<h3 id="x_3">X协议</h3>
<p>X客户端和X服务器使用X协议进行通信，这使得客户端和服务器可以通过网络分离。对于绝大多数个人 Linux 系统来说，X客户端和X服务器都运行在同一个系统上。</p>
<h3 id="xlib">Xlib库</h3>
<p>Xlib 库是X客户端间接用于产生X协议消息的库。它提供一个非常底层的 API 供客户端在X服务器上绘制非常基本的元素，并响应最简单的输入。</p>
<p>GUI程序员应该使用X工具包，这比使用 Xlib 要简单方便。</p>
<h3 id="x_4">X工具包</h3>
<p>是一个GUI库，X客户端可以利用它来极大地简化窗口、菜单和按钮等的创建。诸如此类的 GUI 元素被称为 widget 。</p>
<p>最流行的工具包现在是 GTK+ 和 QT 。它们分别构成了 GNOME 和 KDE 桌面的基础。</p>
<h3 id="_1">窗口管理器</h3>
<p>窗口管理器负责定位屏幕上的窗口。它还负责装饰每个窗口，通常由一个框架和一个带有最大化、最小化和关闭图标的标题栏组成。</p>
<h3 id="guiapi">创建GUI的其他方法——平台无关的窗口API</h3>
<p>比如使用 JAVA， C#， PYTHON 等。</p>
<h2 id="gtk">GTK+简介</h2>
<p>GTK+是一个函数库，它提供了一组已经制作好的组件。</p>
<p>GTK+完全是用C语言编写的，而且绝大多数GTK+软件也是用C语言编写的。许多语言绑定使你可以在其他语言中使用GTK+ ，比如 C++ ， Python ， PHP 等。</p>
<h3 id="glib">GLib 类型系统</h3>
<p>GTK+ 中，有许多以字母g开头的C语言数据类型，如 gint, gchar, gshort 。这是为了跨平台开发。</p>
<p>GLib 和 GObject 提供了一组数据类型、函数和宏的标准替代集来进行内存管理和处理常见任务，从而实现跨平台开发。</p>
<ul>
<li>
<p>gint, guint, gchar, guchar, glong, gulong, gfloat, gdouble 是标准C语言数据类型的简单替代</p>
</li>
<li>
<p>gpointer 与 (void*) 同义。</p>
</li>
<li>
<p>gboolean 用于表示布尔类型的值。可以取值 TRUE 和 FALSE 。</p>
</li>
<li>
<p>gint8, guint8, gint16, guint16, gint32, guint32 是保证字节长度的类型。</p>
</li>
</ul>
<h3 id="gtk_1">GTK+对象系统</h3>
<p>尽管 GTK+ 是完全用C语言编写的，但是它通过 GObject 库支持对象和面向对象编程。这个库通过宏来支持对象继承和多态。</p>
<p>为了方便，所有 Widget 的创建函数都返回一个GtkWidget 的类型。例如：</p>
<div class="codehilite"><pre><span></span><span class="n">GtkWdiget</span><span class="o">*</span> <span class="nf">gtk_window_new</span><span class="p">(</span><span class="n">GtkWindowType</span> <span class="n">type</span><span class="p">);</span>
</pre></div>


<p>可以通过专用的宏实现继承关系间的类型转化：</p>
<div class="codehilite"><pre><span></span><span class="c1">// 把 GtkWidget* 转化成了一个 GtkContainer*</span>
<span class="n">gtk_container_add</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">awidget</span><span class="p">);</span>
</pre></div>


<h3 id="gnome">GNOME 简介</h3>
<p>GNOME 的目的是为 Linux 创建一个统一的桌面。</p>
<p>现在它已经成为 Fedora, Red Hat, Ubuntu 以及 openSUSE 等发行版默认 Linux 桌面的基础。</p>
<h3 id="gnomegtk">安装 GNOME/GTK+ 开发库</h3>
<p>书中介绍了一些方法。</p>
<p>在我使用的 CentOS7 下面，使用这样的命令安装：</p>
<div class="codehilite"><pre><span></span>$ sudo yum -y install gtk2.x86_64
$ sudo yum -y install gtk2-devel.x86_64
$ sudo yum -y install gtk2-engines.x86_64
$ sudo yum -y install libgnome.x86_64
$ sudo yum -y install libgnome-devel.x86_64
$ sudo yum -y install libgnomeui.x86_64
$ sudo yum -y install libgnomeui-devel.x86_64
</pre></div>


<p>可以运行 GTK+ 的演示程序，它还包含了代码：</p>
<div class="codehilite"><pre><span></span>$ gtk-demo
</pre></div>


<p>使用这样的命令来生成编译选项构建 gtk+ 程序：</p>
<div class="codehilite"><pre><span></span><span class="sb">`</span>pkg-config --cflags --libs gtk+-2.0<span class="sb">`</span>
</pre></div>


<p>gtk_window_new 可以创建一个窗口。</p>
<p>一个 gtk 程序的简单框架是：</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="n">Widget</span> <span class="o">*</span><span class="n">window</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span> <span class="c1">// 初始化 GTK+ 库，必须在调用任何 GTK 函数之前调用</span>

    <span class="c1">// 给窗口添加内容</span>

    <span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">window</span><span class="p">);</span> <span class="c1">// 显示实际窗口和其内容</span>
    <span class="n">gtk_main</span><span class="p">();</span> <span class="c1">// 把控制权交给 GTK+ 来启动交互过程，并且一直运行，直到调用 gtk_main_quit 才返回</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h2 id="_2">事件、信号和回调函数</h2>
<p>所有的 GUI 库都有一个共同点：必须存在某种机制来响应用户动作并执行相应代码。</p>
<p>现代窗口系统用事件和事件监听系统来处理这个问题。其思想是，每次用户输入都触发一个事件。程序员需要编写监听这些事件的代码，以及当事件被触发时要执行的代码。</p>
<p>GTK+ 有自己的事件和监听器系统，它们被称为信号和回调函数。</p>
<p>回调函数的原型如：</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">a_callback</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>
</pre></div>


<p>连接回调函数的方法是 g_signal_connect。</p>
<h2 id="_3">组装盒构件</h2>
<p>GUI 的布局对其可以用性来说至关重要。排列构件的真正困难在于，你不能指望所有用户都有相同的屏幕分辨率，或者有相同的窗口大小、主题、字体、颜色方案。</p>
<p>为了保持一致，要避免使用绝对坐标来放置构件，而是采用一种更灵活的布局系统。 GTK+ 通过容器构件来实现这一目标。盒构件是一个非常有用的容器构件类型。</p>
<p>盒是一个不可见的构件，其工作就是包含其他的构件，并控制它们的布局。</p>
<p>使用 gtk_hbox_new 和 gtk_vbox_new 来创建一个横向和纵向的盒构件。</p>
<p>使用 gtk_box_pack_start 或 gtk_box_pack_end 来向盒构件添加构件。</p>
<h2 id="gtk_2">Gtk+构件</h2>
<p>本节介绍了 GtkWindow, GtkEntry, GtkSpinButton, GtkButton, GtkCheckButton, GtkToggleButton, GtkRadioButton, GtkTreeView 的相关 API 。</p>
<h2 id="gnome_1">GNOME 构件</h2>
<p>GTK+ 被设计成独立于桌面的。它不假定运行在 GNOME 中，甚至不假定它运行在 Linux 上。这样， GTK+ 可以被相对容易地移植到 Windows 或者任何其他视窗系统中。但其导致的结果是： GTK+ 缺乏将程序与桌面紧密结合的方法。</p>
<p>GNOME 库包含 GNOME 构件，它们扩展了 GTK+ ，用一些更容易使用的构件替换了 GTK+ 中的部分构件。</p>
<p>略去后续繁杂的内容。</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; since 2018 Diwen Liu</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
